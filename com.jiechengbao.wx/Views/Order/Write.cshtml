
@{
    ViewBag.Title = "填写订单";
    Layout = "~/Views/LayoutPage.cshtml";
}
@using com.jiechengbao.entity
@using com.jiechengbao.wx.Models
<style>
    .mui-bar-nav {
        background-color: #FFFFFF;
    }

    .name-cell,
    .address-cell {
        padding-right: 30px;
    }

    .goods-ul {
        margin-top: 10px;
    }

    .money-p {
        color: #FF0000;
    }

    .money-ul {
        margin-top: 10px;
    }

    .mui-btn-block {
        padding: 10px;
        font-size: 15px;
        margin-top: 10px;
    }
</style>
@{ Address address = ViewBag.Address as Address;
    <ul class="mui-table-view mui-table-view-striped mui-table-view-condensed address-view">
        <li class="mui-table-view-cell">
            <a class="mui-navigate-right" id="atoAddress" href="/Address/Editor?Id=@address.Id">
                <div class="mui-table name-cell">
                    <div class="mui-table-cell mui-col-xs-8">
                        <h4 class="mui-ellipsis">@address.Consignee</h4>
                    </div>
                    <div class="mui-table-cell mui-col-xs-4 mui-text-right">
                        <span class="mui-h5">@address.Phone</span>
                    </div>
                </div>
                <div class="mui-table address-cell">
                    <div class="mui-table-cell mui-col-xs-12">
                        <p class="mui-h6 mui-ellipsis"><i class="mui-icon mui-icon-location"></i>@(address.Province + address.City + address.County + " " + address.Detail)</p>
                    </div>
                </div>
            </a>
        </li>
    </ul>
}

<ul class="mui-table-view goods-ul">
    @foreach (var item in ViewData["CartModelList"] as List<CartModel>)
    {
        <li class="mui-table-view-cell mui-media">
            <a href="javascript:;">
                <img class="mui-media-object mui-pull-left" src="Uploads/@item.PicturePath">
                <div class="mui-media-body">
                    @item.Name
                    <p class='mui-ellipsis'><small>@item.Description</small></p>
                    <p class='mui-ellipsis money-p'><small>￥@item.Price</small><small>x @item.Count</small></p>
                </div>
            </a>
        </li>
    }
</ul>

<ul class="mui-table-view money-ul">
    <li class="mui-table-view-cell">
        商品金额
        <button type="button" class="mui-btn mui-btn-danger mui-btn-outlined">￥@ViewBag.TotalPrice</button>
    </li>
</ul>
<button type="button" class="mui-btn mui-btn-danger mui-btn-block" onclick="CreateOrder();">提交订单</button>

<script>
    function CreateOrder() {
        $.ajax({
            url: "/Order/Add",
            type: "POST",
            success: function(data) {
                if (data == "Expired") {
                    mui.alert("生成订单超时,请重新提交");
                    window.location.href = "/Cart/List";
                }
                else if (data == "Error")
                {
                    mui.alert("订单生成发生错误");
                    window.location.href = "/Cart/List";
                }
                else {
                    window.location.href = "/WxPay/Pay";
                }
            },
            error: function() {
                mui.alert("网页发生错误");
            }
        });
    }
</script>